<html>
  <head>
    <title>Mapping my runs (in Python/Flask)</title>
    <style>
      button:hover {
        color: blue;
      }

    </style>
  </head>

  <body>
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <script type="text/javascript" src="https://rawgit.com/jieter/Leaflet.encoded/master/Polyline.encoded.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <link rel="stylesheet" type="text/css" href="./index.css" />
    <div class="nav">
      <a href="/about">about</a>
    </div>
    <button 
      id="update_url_to_current_view" 
      type="button"
      onclick="placelatlnginurl()"
      >click here to generate sharable URL of current latitude and longitude and zoom level</button> 
    <div id="map" style="width: 100%; height: 100%"></div>

    <script>

    
    function placelatlnginurl(cords){
      console.log("oh shit replacelatlnginurl to " + cords)
      window.history.replaceState('', '', '?latlng=' + cords);
    }

    function getCurrentCords(){
      return [ 43.72927165246686, -105.00802723474892 ]
    }

    var denverCords = [ 39.72927165246686, -105.00802723474892 ]
    var map = L.map('map').setView(denverCords, 13);
          L.tileLayer('https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token={accessToken}', {
            attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, Imagery Â© <a href="https://www.mapbox.com/">Mapbox</a>',
            maxZoom: 22,
            minZoom: 1,
            id: 'mapbox/satellite-v9',
            tileSize: 512,
            zoomOffset: -1,
            accessToken: 'pk.eyJ1Ijoiam9zaHdvcmtzIiwiYSI6ImNrcWk2NzUxeTJhbm8yem4weDFreTY5bjQifQ.Qja1F9B1-i7hK3KOvSYAvg'
          }).addTo(map);

    console.log("deverCords")
    console.log(denverCords)
    var encodedRoutes = {{ runs|safe }}
    var coords_param = [ {{ latlng }} ]
    for (let encoded of encodedRoutes) {
      var coordinates = L.Polyline.fromEncoded(encoded).getLatLngs();
      console.log("got another encoded polyline...");

      L.polyline(
          coordinates,
          {
              color: '#00FF00',
              weight: 2,
              opacity: .7,
              lineJoin: 'round'
          }
      ).addTo(map);
    }
    console.log("trying to use map.setView to: " + String(coords_param))
    if(coords_param) {
      console.log("true")
      map.setView(coords_param, 15)
    }

    map.on('click', 
					function(e){
            console.log(e)
            console.log(e.latlong)
						var coord = e.latlng.toString().split(',');
						var lat = coord[0].split('(');
						var lng = coord[1].split(')');
						console.log("You clicked the map at " + lat[1] + "," + lng[0]);
            console.log("attempting to set URL to where clicked to: " + e.latlng.toString())
            placelatlnginurl(lat[1] + "," + lng[0])
					});

          con
    

    </script>
  </body>
</html>
