<html>
  <head>
    <title>Mapping Josh's Mobility Data</title>
    <link rel="stylesheet" type="text/css" href="/static/index.css" />
  </head>

  <body>
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <script type="text/javascript" src="https://rawgit.com/jieter/Leaflet.encoded/master/Polyline.encoded.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <div class="nav">
      <a href="/about">about</a>
    </div>
  
    <div id="map" style="width: 100%; height: 100%"></div>

    <script>

    
    function placelatlngzoominurl(cords){
      console.log("oh shit placelatlngzoominurl to " + cords)
      zoom = map.getZoom()
      console.log("and zoom to: " + zoom)
      
      window.history.replaceState('', '', '?zoom=' + zoom + '&latlng=' + cords);
    }

    var zoom_param = {{ zoom }}
    var denverCords = [ 39.72927165246686, -105.00802723474892 ]
    var map = L.map('map').setView(denverCords, zoom_param);
          L.tileLayer('https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token={accessToken}', {
            attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, Imagery Â© <a href="https://www.mapbox.com/">Mapbox</a>',
            maxZoom: 22,
            minZoom: 1,
            id: 'mapbox/satellite-v9',
            tileSize: 512,
            zoomOffset: -1,
            accessToken: 'pk.eyJ1Ijoiam9zaHdvcmtzIiwiYSI6ImNrcWk2NzUxeTJhbm8yem4weDFreTY5bjQifQ.Qja1F9B1-i7hK3KOvSYAvg'
          }).addTo(map);

    // markers
    var homebot_office = L.marker([39.74896, -104.999058]).addTo(map);
    homebot_office.bindPopup("<b>Company Office</b><br>For about a year, I worked for a company that had an office available for any employee to use. I used it more than most, because I could park my scooter in the basement. Easy travel, effortless parking");

    var baker_climbing_gym = L.marker([39.725278, -105.002571]).addTo(map);
    baker_climbing_gym.bindPopup("<b>Climbing Gym</b><br>When in Denver, it's the most-frequently-frequented area climbing gym for me. Many, many tracked activities begin, end, or pass through this location.");

    var night_1 = L.marker([43.392302, -108.161194]).addTo(map);
    night_1.bindPopup("<b>Spent first night here</b></br>I'd picked out this campground as 'likely to have a nice spot to sleep', and it totally delivered. Covered pavilion, picnic table, easy hammock-hanging, quiet, etc.");

    var night_2 = L.marker([44.616897, -110.418021]).addTo(map);
    night_2.bindPopup("<b>Spent second night here</b></br>I'd not gotten as far as I'd hoped/planned today, and ran into rain. It was all NBD, and I had tons of downtime in Yellowstone, so had a great time.");

    var night_3 = L.marker([48.391028, -116.496921]).addTo(map);
    night_3.bindPopup("<b>Third night was super easy, stayed at friend's house</b></br> everyone had a restful morning in Sandpoint. Lots of food, a shower, coffee, etc. Felt very peaceful");

    var night_4 = L.marker([50.316613, -119.191597]).addTo(map);
    night_4.bindPopup("<b>4th night, arriving in Vernon, BC: </b></br> I arrived at the site of the training that was happening over the following week.");

    var travel_1 = L.marker([50.571791, -120.434634]).addTo(map);
    travel_1.bindPopup("<b>Travelling to Seattle, night 1</b></br> I left Vernon Friday afternoon, after wrapping up for the week, figured I could get a few hours of travel before the sun went down. I was right, I did, this was one of the most peaceful, beautiful, and alone nights I had on the entire trip. A story could be told about over-night site selection");

    var travel_2 = L.marker([49.672404, -123.164833]).addTo(map);
    travel_2.bindPopup("<b>2nd night of getting to Seattle, at a beautiful campground. I had no idea I was going to be riding through squamish</b></br> I could have spent days/weeks here, climbing and climbing and climbing. Next time?");
    
    var travel_3 = L.marker([47.464656, -122.539632]).addTo(map);
    travel_3.bindPopup("<b>Normandy, Ross's house</b></br> friends, family, peacefulness. It was all lovely, i've spent a few total weeks here now");

    var denver_1 = L.marker([45.788617, -118.222718]).addTo(map);
    denver_1.bindPopup("<b>Seattle to Denver, night 1</b></br> a peaceful spot to spend the night, but the prior gas station was closed, so I was a bit concerned about gas. I had a half-tank in reserve, and expected to need at least some of it. It was also cold-ish.");

    var denver_2 = L.marker([43.019022, -114.229758]).addTo(map);
    denver_2.bindPopup("<b>returning to Denver, night 2</b></br> def my least favorite night out on the trip. It was late, I was tired, was having trouble even finding trees that could hold a hammock and were not right next to a possibly-in-use house");

    var denver_3 = L.marker([43.481899, -110.767293]).addTo(map);
    denver_3.bindPopup("<b>The city of Jackson Hole, WY</b></br> I hung out for the day, almost went climbing but was on a bit of a schedule for getting back to Denver. When I quested off on the trip, I had no idea I'd be passing through Jackson Hole.");

    var denver_4 = L.marker([43.479022, -110.809468]).addTo(map);
    denver_4.bindPopup("<b>this entire road, end-to-end, was stopped traffic</b></br> On my way out of town, for miles (maybe 12?) traffic was nearly completely stopped. I scooted past everyone at a cool 30 mph, was hardly affected. It was/still is the longest traffic jam I've ever passed by on my scooter");

    var jackson_hole_1 = L.marker([43.587646, -110.822183]).addTo(map);
    jackson_hole_1.bindPopup("<b>thai food + beautiful sunset views</b></br> learned that the road I was planning on taking next was closed. I ended up taking it (rode under/around the gate) and had a grand ol' time. The only 'issue' was that the road was sometimes dirt instead of pavement. I survived.");

    var denver_5 = L.marker([43.278375, -109.110637]).addTo(map);
    denver_5.bindPopup("<b>3rd night, returning to Denver</b></br> slimmer hammock camping pickings out here than I prefer. It was fine.");

    var denver_6 = L.marker([39.903239, -105.777719]).addTo(map);
    denver_6.bindPopup("<b>4th night/last night</b></br> almost back to Denver. These felt like big travel days at this point. Not undoable, but deff tiring");

    // var jackson_hole_1 = L.marker([49.672404, -123.164833]).addTo(map);
    // jackson_hole_1.bindPopup("<b>title</b></br> description");

    // var jackson_hole_1 = L.marker([49.672404, -123.164833]).addTo(map);
    // jackson_hole_1.bindPopup("<b>title</b></br> description");

    // var jackson_hole_1 = L.marker([49.672404, -123.164833]).addTo(map);
    // jackson_hole_1.bindPopup("<b>title</b></br> description");

    // var jackson_hole_1 = L.marker([49.672404, -123.164833]).addTo(map);
    // jackson_hole_1.bindPopup("<b>title</b></br> description");

    // var jackson_hole_1 = L.marker([49.672404, -123.164833]).addTo(map);
    // jackson_hole_1.bindPopup("<b>title</b></br> description");
    
    // end markers

    var encodedRoutes = {{ runs|safe }}
    var coords_param = [ {{ latlng }} ]
    for (let encoded of encodedRoutes) {
      var coordinates = L.Polyline.fromEncoded(encoded).getLatLngs();

      L.polyline(
          coordinates,
          {
              color: '#00FF00',
              weight: 2,
              opacity: .7,
              lineJoin: 'round'
          }
      ).addTo(map);
    }
    if(coords_param) {
      console.log("trying to use map.setView to: " + String(coords_param))
      console.log("setting view...")
      map.setView(coords_param)
    }

    if(zoom_param) {
      console.log("trying to map.setZoom to: " + String(zoom_param))
      console.log("setting zoom...")
      map.setZoom(zoom_param)
    }

    map.on('click', 
					function(e){
            console.log(e)
            console.log(e.latlong)
						var coord = e.latlng.toString().split(',');
						var lat = coord[0].split('(');
						var lng = coord[1].split(')');
						console.log("You clicked the map at " + lat[1] + "," + lng[0]);
            console.log("attempting to set URL to where clicked to: " + e.latlng.toString())
            placelatlngzoominurl(lat[1] + "," + lng[0])
					});

    // adding labels, will do this in a 'real' way sometime. store as another CSV, stream from python as [latlng|label title|detailed text]
    // or something like that, same as the polylines?
    
    

    </script>
  </body>
</html>
